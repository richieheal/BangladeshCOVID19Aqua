---
title: "AnalysisCOVID19Data"
author: "Richard Heal"
date: "8/24/2020"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

#######################################################################
# Load in the data
#######################################################################
DataFile <- "COVIDAquaculture_Data_RawDATA.csv"
RawData <- read.csv(DataFile, header = TRUE, skip = 2, stringsAsFactors = TRUE)

```

## Analysis of Aquaculture in Bangladesh Pre and Post COVID 19

This document details the analysis of farm survey data taken pre and post COVID 19.

```{r Effect on Labour BASIC STATS, include=FALSE}

#############################################################
#
# Analysis on the effect of COVID on labour for the farms
#
# Here the number of workers and the cost of labour for 
# permanent, seasonal and non-technical staff
#
# 
#############################################################
# Overall figures
#############################################################
library(data.table)
RawData <- setDT(RawData)
RawData[, TotLab_1 := (PermLab_1 + SeasLab_1 + NonAqLab_1)]
RawData[, TotLab_2 := (PermLab_2 + SeasLab_2 + NonAqLab_2)]
RawData[, DiffLab := (TotLab_2 - TotLab_1)]
RawData[, DiffPerm := (PermLab_2 - PermLab_1)]
RawData[, DiffSeas := (SeasLab_2 - SeasLab_1)]
RawData[, DiffNonAq := (NonAqLab_2 - NonAqLab_1)]
Farms_MoreStaff <- sum(RawData$DiffLab > 0)
Farms_LessStaff <- sum(RawData$DiffLab < 0)
Farms_SameStaff <- sum(RawData$DiffLab == 0)

Mean_StaffChange <- mean(RawData$DiffLab, na.rm = TRUE)
Median_StaffChange <- median(RawData$DiffLab, na.rm = TRUE)

Total_Perm_1 <- sum(RawData$PermLab_1)
Total_Seas_1 <- sum(RawData$SeasLab_1)
Total_NonAq_1 <- sum(RawData$NonAqLab_1)
Total_Perm_2 <- sum(RawData$PermLab_2)
Total_Seas_2 <- sum(RawData$SeasLab_2)
Total_NonAq_2 <- sum(RawData$NonAqLab_2)


```
  
### Effect on labour - employee numbers
  
The overall effect on the labour numbers:

  Farms with more staff: **`r Farms_MoreStaff`**  
  Farms with less staff: **`r Farms_LessStaff`**  
  Farms with the same number of staff employed: **`r Farms_SameStaff`**  

So most farms reported a decrease in employee numbers.  The mean change in employee number was **`r Mean_StaffChange`** and the median change was **`r Median_StaffChange`**.

Before COVID19 the farms employed **`r Total_Perm_1`** permanent staff, **`r Total_Seas_1`** seasonal staff and **`r Total_NonAq_1`** non-technical staff.

After COVID19 the farms employed **`r Total_Perm_2`** permanent staff, **`r Total_Seas_2`** seasonal staff and **`r Total_NonAq_2`** non-technical staff.  
  
  Difference in permanent staff numbers: **`r Total_Perm_2 - Total_Perm_1`**  
  Difference in seasonal staff numbers: **`r Total_Seas_2 - Total_Seas_1`**  
  Difference in non-technical staff numbers: **`r Total_NonAq_2 - Total_NonAq_1`**  
  
The effect was appears to be a reduction in permanent and non-technical staff numbers with seasonal numbers remaining consistent. However, it is a little more complicated than that.  

For example, of all the farms **`r sum(RawData$DiffPerm < 0)`** reduced permanent staff, **`r sum(RawData$DiffPerm > 0)`** increased permanent staff and **`r sum(RawData$DiffPerm == 0)`** kept the same number of permanent staff. 

INPUT THE RANGE OF VALUES.

Those farms that reduced permanent staff did so by a mean of **`r mean(RawData$DiffPerm[which(RawData$DiffPerm < 0)])`** employees with a median of **`r median(RawData$DiffPerm[which(RawData$DiffPerm < 0)])`** and a range of **`r min(RawData$DiffPerm[which(RawData$DiffPerm < 0)])`** to **`r max(RawData$DiffPerm[which(RawData$DiffPerm < 0)])`**. Those farms that increased permanent staff did so by a mean of **`r mean(RawData$DiffPerm[which(RawData$DiffPerm > 0)])`** employees with a median of **`r median(RawData$DiffPerm[which(RawData$DiffPerm > 0)])`**.

For seasonal staff, of all the farms **`r sum(RawData$DiffSeas < 0)`** reduced seasonal staff, **`r sum(RawData$DiffSeas > 0)`** increased seasonal staff and **`r sum(RawData$DiffSeas == 0)`** kept the same number of seasonal staff.

Those farms that reduced seasonal staff did so by a mean of **`r mean(RawData$DiffSeas[which(RawData$DiffSeas < 0)])`** employees with a median of **`r median(RawData$DiffSeas[which(RawData$DiffSeas < 0)])`** and a range of **`r min(RawData$DiffSeas[which(RawData$DiffSeas < 0)])`** to **`r max(RawData$DiffSeas[which(RawData$DiffSeas < 0)])`**. Those farms that increased seasonal staff did so by a mean of **`r mean(RawData$DiffSeas[which(RawData$DiffSeas > 0)])`** employees with a median of **`r median(RawData$DiffSeas[which(RawData$DiffSeas > 0)])`**.

For non-technical staff, of all the farms **`r sum(RawData$DiffNonAq < 0)`** reduced non-technical staff, **`r sum(RawData$DiffNonAq > 0)`** increased non-technical staff and **`r sum(RawData$DiffNonAq == 0)`** kept the same number of non-technical staff.

Those farms that reduced non-technical staff did so by a mean of **`r mean(RawData$DiffNonAq[which(RawData$DiffNonAq < 0)])`** employees with a median of **`r median(RawData$DiffNonAq[which(RawData$DiffNonAq < 0)])`** and a range of **`r min(RawData$DiffNonAq[which(RawData$DiffNonAq < 0)])`** to **`r max(RawData$DiffNonAq[which(RawData$DiffNonAq < 0)])`**. Those farms that increased non-technical staff did so by a mean of **`r mean(RawData$DiffNonAq[which(RawData$DiffNonAq > 0)])`** employees with a median of **`r median(RawData$DiffNonAq[which(RawData$DiffNonAq > 0)])`**.

The trend in seasonal staff was either a reduction or increase by a single employee, or no change occurring. Of those **`r sum(RawData$DiffSeas > 0)`** farms increasing the seasonal staff, **`r sum(RawData$DiffPerm[which(RawData$DiffSeas > 0)] < 0)`** farms had decreased their permanent staff, **`r sum(RawData$DiffNonAq[which(RawData$DiffSeas > 0)] < 0)`** farms had decreased their non-technical staff, and **`r sum(RawData$DiffNonAq[which(RawData$DiffSeas > 0)]< 0 & RawData$DiffPerm[which(RawData$DiffSeas > 0)] < 0)`** reduced both permanent and non-technical staff. **`r sum(RawData$DiffPerm[which(RawData$DiffSeas > 0)] == 0)`** farms kept the same number of permanent staff, and  **`r sum(RawData$DiffNonAq[which(RawData$DiffSeas > 0)] == 0)`** kept the same number of non-technical staff, and **`r sum(RawData$DiffNonAq[which(RawData$DiffSeas > 0)] == 0 & RawData$DiffPerm[which(RawData$DiffSeas > 0)] == 0)`** kept the same number of permanent **and** non-technical staff, whilst increasing seasonal employees.  

```{r Effect on Labour COSTS BASIC STATS, include=FALSE}
#########################################################
#
# Here some basic figures on the cost of labour changes
#
#########################################################
MeanPermCost_1 <- mean(RawData$PermLabCOST_1, na.rm = TRUE)
MeanPermCost_2 <- mean(RawData$PermLabCOST_2, na.rm = TRUE)
MeanSeasCost_1 <- mean(RawData$SeasLabCOST_1, na.rm = TRUE)
MeanSeasCost_2 <- mean(RawData$SeasLabCOST_2, na.rm = TRUE)
MeanNonAqCost_1 <- mean(RawData$NonAqLabCOST_1, na.rm = TRUE)
MeanNonAqCost_2 <- mean(RawData$NonAqLabCOST_2, na.rm = TRUE)

Mean_Total_1 <- (MeanPermCost_1 + MeanSeasCost_1 + MeanNonAqCost_1)/3
Mean_Total_2 <- (MeanPermCost_2 + MeanSeasCost_2 + MeanNonAqCost_2)/3

############################################################
# Paired t-tests
############################################################
Perm_Cost_TTest <- t.test(RawData$PermLabCOST_2,
                          RawData$PermLabCOST_1,
                          alternative = "less",
                          paired = TRUE,
                          na.action = na.omit)

Seas_Cost_TTest <- t.test(RawData$SeasLabCOST_2,
                          RawData$SeasLabCOST_1,
                          alternative = "less",
                          paired = TRUE,
                          na.action = na.omit)

NonAq_Cost_TTest <- t.test(RawData$NonAqLabCOST_2,
                          RawData$NonAqLabCOST_1,
                          alternative = "less",
                          paired = TRUE,
                          na.action = na.omit)
```

### Effect on labour - costs of employment per day
  
The overall effect on the labour costs:

The mean labour cost pre-COVID was **`r Mean_Total_1`** and was **`r Mean_Total_2`** post-COVID suggesting a small decrease in labour cost due to COVID. For each of the employment types the means were:  
  
  Pre-covid Permanent Labour cost mean: **`r MeanPermCost_1`**  
  Post-covid Permanent Labour cost mean: **`r MeanPermCost_2`**  
  
  Pre-covid Seasonal Labour cost mean: **`r MeanSeasCost_1`**  
  Post-covid Seasonal Labour cost mean: **`r MeanSeasCost_2`**  
  
  Pre-covid Non-technical Labour cost mean: **`r MeanNonAqCost_1`**  
  Post-covid Non-technical Labour cost mean: **`r MeanNonAqCost_2`**  

Therefore, there has been reduction in all employment sector costs due to COVID. These values are the costs per employee and therefore this suggests a decrease in the wages for sector employees.

Assuming the costs are normally distributed (which is a fair assumption to make) we can check whether there is a statistical difference between the costs per employee. This will be a pairwise test using farms with before and after data.

#### T-test for Labour Costs

To test whether there was a significant difference in the costs per employee pre and post COVID 19 a one-tailed paired t-test was performed on the data.

For permanent employee costs:  
        P-value: **`r Perm_Cost_TTest$p.value`**  
        Test Statistic: **`r Perm_Cost_TTest$statistic`**  
        Degrees of Freedom: **`r Perm_Cost_TTest$parameter`**  
        Estimated difference in means: **`r Perm_Cost_TTest$estimate`**  
          
For seasonal employee costs:    
        P-value: **`r Seas_Cost_TTest$p.value`**  
        Test Statistic: **`r Seas_Cost_TTest$statistic`**  
        Degrees of Freedom: **`r Seas_Cost_TTest$parameter`**  
        Estimated difference in means: **`r Seas_Cost_TTest$estimate`**  
          
For non-technical employee costs:    
        P-value: **`r NonAq_Cost_TTest$p.value`**  
        Test Statistic: **`r NonAq_Cost_TTest$statistic`**  
        Degrees of Freedom: **`r NonAq_Cost_TTest$parameter`**  
        Estimated difference in means: **`r NonAq_Cost_TTest$estimate`**  

The results suggest a significant decrease in the costs of labour for seasonal and non-technical employees with a decrease of 0.5USD per day (**`r Seas_Cost_TTest$estimate`** for seasonal staff and **`r NonAq_Cost_TTest$estimate`** for non-technical staff). There was no significant difference in the costs for permanent staff.  

```{r Effect on Labour SCATTER PLOTS, include=FALSE}
##############################################################
#Going to produce scatter plots pre and post covid
###############################################################
library(plotly)
Offset = 0.1
MaxX = 6 + Offset
MaxY = 6+ Offset
MinX = -Offset
MinY = -Offset
SymbolSize = 7

# Set axis titles
x1 <- list(title = list(text = "Employee Number Pre-COVID19"), 
                      range = c(MinX,MaxX))
y1 <- list(title = list(text = "Employee Number Post-COVID19"),
                      range = c(MinY,MaxY))

PermWorkersPerFarmPlot <- plot_ly(data = RawData, type = 'scatter', mode = 'markers+line') %>%
  add_trace(name = 'NoChangeLine',
            mode = 'line',
            fill = 'tozeroy', fillcolor = 'rgba(240,240,240, 0.8)',
            showlegend = FALSE,
            line = list(color = 'rgb(200,200,200)', width = 0.5, dash = '5px'),
            x = c(0,MaxX),
            y = c(0,MaxY)) %>%
  add_trace(mode = 'markers',
            marker = list(color = 'rgb(0,0,0)', size = SymbolSize, symbol = 'triangle-up'),
            name = 'Permanent Labour Numbers',
            x = ~jitter(PermLab_1, amount = 0),
            y = ~jitter(PermLab_2, amount = 0)) %>%
  layout(showlegend = FALSE,
         xaxis = list(title = list(text = "Permanent Employee Number Pre-COVID19"), 
                      range = c(MinX,MaxX)),
         yaxis = y1)
SeasWorkersPerFarmPlot <- plot_ly(data = RawData, type = 'scatter', mode = 'markers+line') %>%
  add_trace(name = 'NoChangeLine',
            mode = 'line',
            fill = 'tozeroy', fillcolor = 'rgba(240,240,240, 0.8)',
            showlegend = FALSE,
            line = list(color = 'rgb(200,200,200)', width = 0.5, dash = '5px'),
            x = c(0,MaxX),
            y = c(0,MaxY)) %>%
  add_trace(mode = 'markers',
            marker = list(color = 'rgb(0,0,0)', size = SymbolSize, symbol = 'triangle-down'),
            name = 'Seasonal Labour',
            x = ~jitter(SeasLab_1, amount = 0),
            y = ~jitter(SeasLab_2, amount = 0)) %>%
  layout(showlegend = FALSE,
         xaxis = list(title = list(text = "Seasonal Employee Number Pre-COVID19"), 
                      range = c(MinX,MaxX)),
         yaxis = y1)
NonAqWorkersPerFarmPlot <- plot_ly(data = RawData, type = 'scatter', mode = 'markers+line') %>%
  add_trace(name = 'NoChangeLine',
            mode = 'line',
            fill = 'tozeroy', fillcolor = 'rgba(240,240,240, 0.8)',
            showlegend = FALSE,
            line = list(color = 'rgb(200,200,200)', width = 0.5, dash = '5px'),
            x = c(0,MaxX),
            y = c(0,MaxY)) %>%
  add_trace(mode = 'markers',
            marker = list(color = 'rgb(0,0,0)', size = SymbolSize, symbol = 'circle'),
            name = 'Non-specialist Labour',
            x = ~jitter(NonAqLab_1, amount = 0),
            y = ~jitter(NonAqLab_2, amount = 0)) %>%
  layout(showlegend = FALSE,
         xaxis = list(title = list(text = "Non-technical Employee Number Pre-COVID19"), 
                      range = c(MinX,MaxX)),
         yaxis = y1)
WorkersPerFarmPlot <- subplot(PermWorkersPerFarmPlot,
                              SeasWorkersPerFarmPlot,
                              NonAqWorkersPerFarmPlot,
                              nrows = 1,
                              shareY = TRUE,
                              shareX = TRUE,
                              titleX = TRUE,
                              titleY = TRUE)

####################################################################################
#
# Repeat for costs
#
#####################################################################################
Offset = 0.1
MaxX = 6 + Offset
MaxY = 6+ Offset
MinX = 2 - Offset
MinY = 2 - Offset
SymbolSize = 7

# Set axis titles
x1 <- list(title = list(text = "Labour Cost Pre-COVID19 (USD)"), 
                      range = c(MinX,MaxX))
y1 <- list(title = list(text = "Labour Cost Post-COVID19"),
                      range = c(MinY,MaxY),
           showline = T)

PermWorkersCOSTPerFarmPlot <- plot_ly(data = RawData, type = 'scatter', mode = 'markers+line') %>%
  add_trace(name = 'NoChangeLine',
            mode = 'line',
            fill = 'tozeroy', fillcolor = 'rgba(240,240,240, 0.8)',
            showlegend = FALSE,
            line = list(color = 'rgb(200,200,200)', width = 0.5, dash = '5px'),
            x = c(0,MaxX),
            y = c(0,MaxY)) %>%
  add_trace(mode = 'markers',
            marker = list(color = 'rgb(0,0,0)', size = SymbolSize, symbol = 'triangle-up-open'),
            name = 'Permanent Labour Numbers',
            x = ~jitter(PermLabCOST_1, amount = 0),
            y = ~jitter(PermLabCOST_2, amount = 0)) %>%
  layout(showlegend = FALSE,
         yaxis = y1,
         xaxis = list(title = list(text = "Permanent Labour Cost Pre-COVID19 (USD)"),
                      range = c(MinY,MaxY),
                      showline = T))
SeasWorkersCOSTPerFarmPlot <- plot_ly(data = RawData, type = 'scatter', mode = 'markers+line') %>%
  add_trace(name = 'NoChangeLine',
            mode = 'line',
            fill = 'tozeroy', fillcolor = 'rgba(240,240,240, 0.8)',
            showlegend = FALSE,
            line = list(color = 'rgb(200,200,200)', width = 0.5, dash = '5px'),
            x = c(0,MaxX),
            y = c(0,MaxY)) %>%
  add_trace(mode = 'markers',
            marker = list(color = 'rgb(0,0,0)', size = SymbolSize, symbol = 'triangle-down-open'),
            name = 'Seasonal Labour',
            x = ~jitter(SeasLabCOST_1, amount = 0),
            y = ~jitter(SeasLabCOST_2, amount = 0)) %>%
  layout(showlegend = FALSE,
         yaxis = y1,
         xaxis = list(title = list(text = "Seasonal Labour Cost Pre-COVID19 (USD)"),
                      range = c(MinY,MaxY),
                      showline = T))
NonAqWorkersCOSTPerFarmPlot <- plot_ly(data = RawData, type = 'scatter', mode = 'markers+line') %>%
  add_trace(name = 'NoChangeLine',
            mode = 'line',
            fill = 'tozeroy', fillcolor = 'rgba(240,240,240, 0.8)',
            showlegend = FALSE,
            line = list(color = 'rgb(200,200,200)', width = 0.5, dash = '5px'),
            x = c(0,MaxX),
            y = c(0,MaxY)) %>%
  add_trace(mode = 'markers',
            marker = list(color = 'rgb(0,0,0)', size = SymbolSize, symbol = 'circle-open'),
            name = 'Non-specialist Labour',
            x = ~jitter(NonAqLabCOST_1, amount = 0),
            y = ~jitter(NonAqLabCOST_2, amount = 0)) %>%
  layout(showlegend = FALSE,
         yaxis = y1,
         xaxis = list(title = list(text = "Non-technical Labour Cost Pre-COVID19 (USD)"),
                      range = c(MinY,MaxY),
                      showline = T))
WorkersCOSTPerFarmPlot <- subplot(PermWorkersCOSTPerFarmPlot,
                              SeasWorkersCOSTPerFarmPlot,
                              NonAqWorkersCOSTPerFarmPlot,
                              nrows = 1,
                              shareY = TRUE,
                              shareX = TRUE,
                              titleX = TRUE,
                              titleY = TRUE)

WorkSubplot <- subplot(WorkersPerFarmPlot,
                       WorkersCOSTPerFarmPlot,
                       nrows = 2,
                       margin = 0.1,
                       titleX = TRUE,
                       titleY = TRUE)
```

### Scatter plots to show the effect

Here the effect of COVID19 is explored on the labour used to run the farms.

`r WorkersPerFarmPlot`

`r WorkersCOSTPerFarmPlot`

And, combined into a subplot

`r WorkSubplot`

### Summary

These results suggest:

 1. There are fewer permanent employees post-COVID 19 working on farms but the cost of their labour remains the same
 2. There are similar numbers of seasonal workers on farms post-COVID 19 and the cost of their labour is significantly reduced
 3. There are fewer non-technical staff on farms and their cost of labour is significantly less
 4. There is evidence to suggest some farms have reduced permanent and non-technical staff and replaced them with a single seasonal worker
 
```{r Total Number of Employees and Total Cost, include=FALSE}
#####################################################################################
# Looking at the effect on the total number of employees and the overall cost
#####################################################################################
# Insert the total cost for pre and post covid
RawData[, TotalCOST_Perm_1 := (PermLab_1 * PermLabCOST_1)]
RawData[, TotalCOST_Seas_1 := (SeasLab_1 * SeasLabCOST_1)]
RawData[, TotalCOST_NonAq_1 := (NonAqLab_1 * NonAqLabCOST_1)]
RawData[, TotalCOST_Perm_2 := (PermLab_2 * PermLabCOST_2)]
RawData[, TotalCOST_Seas_2 := (SeasLab_2 * SeasLabCOST_2)]
RawData[, TotalCOST_NonAq_2 := (NonAqLab_2 * NonAqLabCOST_2)]
RawData[, TotalCOST_1 := rowSums(.SD, na.rm = TRUE), .SDcols = c("TotalCOST_Perm_1", "TotalCOST_Seas_1", "TotalCOST_NonAq_1")]
RawData[, TotalCOST_2 := rowSums(.SD, na.rm = TRUE), .SDcols = c("TotalCOST_Perm_2", "TotalCOST_Seas_2", "TotalCOST_NonAq_2")]
RawData[, DiffTotalCOST := TotalCOST_2 - TotalCOST_1]


# Plot the difference in number versus the difference in cost

# Size of the bubble is the pre-covid19 total cost of labour and the colourscale is the post-covd19 cost
QuadrantTotalLabPlot <- plot_ly(data = RawData, type = 'scatter', mode = 'markers') %>%
  add_trace(name = 'Differences',
            mode = 'markers',
            x = ~DiffLab,
            y = ~DiffTotalCOST,
            marker = list(size = ~TotalCOST_1, color = ~TotalCOST_2, colorscale = 'Greys',
                          line = list(color = 'rgb(80,80,80)'),
                          sizemode = 'diameter', opacity = 0.5)) %>%
  layout(
    xaxis = list(title = "Difference in Staff Number",
                 range = c(-6,2)),
    yaxis = list(title = "Difference in total cost (USD)",
                 range = c(-35,5))
  )

# Try dumbbell for pre-covid total cost and bubble for post-covid cost and positioned on axis with total number of staff as size of bubble
PermColor <- "rgb(102,194,165)"
SeasColor <- "rgb(252,141,98)"
NonAqColor <- "rgb(141,160,203)"
MarkerSize <- 7

SingleTotalLabDumbbellPlot <- plot_ly(data = RawData, type = 'scatter', mode = 'markers') %>%
  add_segments(x = ~PermLabCOST_2, xend = ~PermLabCOST_1, y = ~(((as.numeric(X)-1) * 3) + 1), yend = ~(((as.numeric(X)-1) * 3) + 1), 
               showlegend = TRUE,
               name = 'Permanent',
               line = list(color = PermColor)) %>%
  add_markers(x = ~PermLabCOST_1,
              y = ~(((as.numeric(X)-1) * 3) + 1),
              name = "Pre-Covid",
              showlegend = TRUE,
              marker = list(size = MarkerSize, color = 'rgb(80,80,80)',
                          line = list(color = 'rgb(80,80,80)'),
                          sizemode = 'diameter', opacity = 0.5)) %>%
  add_markers(name = 'Post-Covid',
            showlegend = TRUE,
              x = ~PermLabCOST_2,
            y = ~(((as.numeric(X)-1) * 3) + 1),
            marker = list(size = MarkerSize, color = 'rgb(0,0,0)',
                          line = list(color = 'rgb(0,0,0)'),
                          sizemode = 'diameter', opacity = 0.5)) %>%
  add_segments(x = ~SeasLabCOST_2, xend = ~SeasLabCOST_1, y = ~(((as.numeric(X)-1) * 3) + 2), yend = ~(((as.numeric(X)-1) * 3) + 2), 
               showlegend = TRUE,
               name = 'Seasonal',
               line = list(color = SeasColor)) %>%
  add_markers(x = ~SeasLabCOST_1,
              y = ~(((as.numeric(X)-1) * 3) + 2),
              name = "Pre-Covid",
              showlegend = FALSE,
              marker = list(size = MarkerSize, color = 'rgb(80,80,80)',
                          line = list(color = 'rgb(80,80,80)'),
                          sizemode = 'diameter', opacity = 0.5)) %>%
  add_markers(name = 'Post-Covid',
              showlegend = FALSE,
            x = ~SeasLabCOST_2,
            y = ~(((as.numeric(X)-1) * 3) + 2),
            marker = list(size = MarkerSize, color = 'rgb(0,0,0)',
                          line = list(color = 'rgb(0,0,0)'),
                          sizemode = 'diameter', opacity = 0.5)) %>%
  add_segments(x = ~NonAqLabCOST_2, xend = ~NonAqLabCOST_1, y = ~(((as.numeric(X)-1) * 3) + 3), yend = ~(((as.numeric(X)-1) * 3) + 3), 
               showlegend = TRUE,
               name = 'Non-technical',
               line = list(color = NonAqColor)) %>%
  add_markers(x = ~NonAqLabCOST_1,
              y = ~(((as.numeric(X)-1) * 3) + 3),
              name = "Pre-Covid",
              showlegend = FALSE,
              marker = list(size = MarkerSize, color = 'rgb(80,80,80)',
                          line = list(color = 'rgb(80,80,80)'),
                          sizemode = 'diameter', opacity = 0.5)) %>%
  add_markers(name = 'Post-Covid',
              showlegend = FALSE,
            x = ~NonAqLabCOST_2,
            y = ~(((as.numeric(X)-1) * 3) + 3),
            marker = list(size = MarkerSize, color = 'rgb(0,0,0)',
                          line = list(color = 'rgb(80,80,80)'),
                          sizemode = 'diameter', opacity = 0.5)) %>%
  layout(
    xaxis = list(title = "Unit Labour Cost (USD)",
                 range = c(1,6), showline = TRUE),
    yaxis = list(title = "Farm",
                 range = c(0,122))
  )

############################################################
# Single plots to create a subplot
###########################################################
PreMarker = 'square-open'
PostMarker = 'circle'
PreMarkerColor = 'rgb(0,0,0)'
PostMarkerColor = 'rgb(0,0,0)'
SegmentLineColor = 'rgb(50,50,50)'

SingleTotalLabDumbbellPlot_PERM <- plot_ly(data = RawData, type = 'scatter', mode = 'markers') %>%
  add_segments(x = ~PermLabCOST_2, xend = ~PermLabCOST_1, y = ~as.numeric(X), yend = ~as.numeric(X), 
               showlegend = FALSE,
               name = 'Permanent',
               line = list(color = SegmentLineColor)) %>%
  add_markers(x = ~PermLabCOST_1,
              y = ~as.numeric(X),
              name = "Pre-Covid",
              showlegend = TRUE,
              marker = list(symbol = PreMarker,
                            size = MarkerSize, 
                          color = PreMarkerColor,
                          line = list(color = 'rgb(0,0,0)'),
                          sizemode = 'diameter', opacity = 0.5)) %>%
  add_markers(name = 'Post-Covid',
            showlegend = TRUE,
              x = ~PermLabCOST_2,
            y = ~as.numeric(X),
            marker = list(symbol = PostMarker,
                          size = MarkerSize, 
                          color = PostMarkerColor,
                          line = list(color = 'rgb(0,0,0)'),
                          sizemode = 'diameter', opacity = 0.5)) %>%
  layout(
    shapes = list(
      list(type = 'line', layer = 'bottom', 
                  y0 = 0, y1 = 41,
                  x0 = MeanPermCost_1, x1 = MeanPermCost_1,
                  line = list(color = 'rgb(200,200,200)', dash = 'dot', width = 0.5)),
      list(type = 'line', layer = 'bottom', 
                  y0 = 0, y1 = 41,
                  x0 = MeanPermCost_2, x1 = MeanPermCost_2,
                  line = list(color = 'rgb(50,50,50)', dash = 'dot', width = 0.5))
      ),
    xaxis = list(title = "Permanent Staff<br>Unit Labour Cost (USD)",
                 range = c(1,6.5), showline = TRUE, showgrid = FALSE),
    yaxis = list(title = "Farm",showticklabels = FALSE,
                 range = c(0,41), showline = TRUE, showgrid = FALSE)
  )

SingleTotalLabDumbbellPlot_SEAS <- plot_ly(data = RawData, type = 'scatter', mode = 'markers') %>%
  add_segments(x = ~SeasLabCOST_2, xend = ~SeasLabCOST_1, y = ~as.numeric(X), yend = ~as.numeric(X), 
               showlegend = FALSE,
               name = 'Seasonal',
               line = list(color = SegmentLineColor)) %>%
  add_markers(x = ~SeasLabCOST_1,
              y = ~as.numeric(X),
              name = "Pre-Covid",
              showlegend = FALSE,
              marker = list(symbol = PreMarker,
                            size = MarkerSize, 
                          color = PreMarkerColor,
                          line = list(color = 'rgb(0,0,0)'),
                          sizemode = 'diameter', opacity = 0.5)) %>%
  add_markers(name = 'Post-Covid',
              showlegend = FALSE,
            x = ~SeasLabCOST_2,
            y = ~as.numeric(X),
            marker = list(symbol = PostMarker,
                          size = MarkerSize, 
                          color = PostMarkerColor,
                          line = list(color = 'rgb(0,0,0)'),
                          sizemode = 'diameter', opacity = 0.5)) %>%
  layout(
    shapes = list(
      list(type = 'line', layer = 'bottom', 
                  y0 = 0, y1 = 41,
                  x0 = MeanSeasCost_1, x1 = MeanSeasCost_1,
                  line = list(color = 'rgb(200,200,200)', dash = 'dot', width = 0.5)),
      list(type = 'line', layer = 'bottom', 
                  y0 = 0, y1 = 41,
                  x0 = MeanSeasCost_2, x1 = MeanSeasCost_2,
                  line = list(color = 'rgb(50,50,50)', dash = 'dot', width = 0.5))
      ),
    xaxis = list(title = "Seasonal Staff<br>Unit Labour Cost (USD)",
                 range = c(2,6), showline = TRUE, showgrid = FALSE),
    yaxis = list(title = "",showticklabels = FALSE,
                 range = c(0,41), showline = TRUE, showgrid = FALSE)
  )

SingleTotalLabDumbbellPlot_NONAQ <- plot_ly(data = RawData, type = 'scatter', mode = 'markers') %>%
  add_segments(x = ~NonAqLabCOST_2, xend = ~NonAqLabCOST_1, y = ~as.numeric(X), yend = ~as.numeric(X), 
               showlegend = FALSE,
               name = 'Non-technical',
               line = list(color = SegmentLineColor)) %>%
  add_markers(x = ~NonAqLabCOST_1,
              y = ~as.numeric(X),
              name = "Pre-Covid",
              showlegend = FALSE,
              marker = list(
                          symbol = PreMarker,
                          size = MarkerSize, 
                          color = PreMarkerColor,
                          line = list(color = 'rgb(0,0,0)'),
                          sizemode = 'diameter', opacity = 0.5)) %>%
  add_markers(name = 'Post-Covid',
              showlegend = FALSE,
            x = ~NonAqLabCOST_2,
            y = ~as.numeric(X),
            marker = list(symbol = PostMarker,
                          size = MarkerSize, 
                          color = PostMarkerColor,
                          line = list(color = 'rgb(0,0,0)'),
                          sizemode = 'diameter', opacity = 0.5)) %>%
  layout(
    shapes = list(
      list(type = 'line', layer = 'bottom', 
                  y0 = 0, y1 = 41,
                  x0 = MeanNonAqCost_1, x1 = MeanNonAqCost_1,
                  line = list(color = 'rgb(200,200,200)', dash = 'dot', width = 0.5)),
      list(type = 'line', layer = 'bottom', 
                  y0 = 0, y1 = 41,
                  x0 = MeanNonAqCost_2, x1 = MeanNonAqCost_2,
                  line = list(color = 'rgb(50,50,50)', dash = 'dot', width = 0.5))
      ),
    xaxis = list(title = "Non-technical Staff<br>Unit Labour Cost (USD)",
                 range = c(2,6), showline = TRUE, showgrid = FALSE),
    yaxis = list(title = "", showticklabels = FALSE,
                 range = c(0,41), showline = TRUE, showgrid = FALSE)
  )

SingleTotalLabDumbbellPlot_Subplot <- subplot(SingleTotalLabDumbbellPlot_PERM,
                                              SingleTotalLabDumbbellPlot_SEAS,
                                              SingleTotalLabDumbbellPlot_NONAQ,
                                              titleX = TRUE, titleY = TRUE, shareY = FALSE,
                                              margin = 0.05)

```

### Total Labour Costs

The total mean farm labour costs (cost per type of worker x number of workers) was **`r mean(RawData$TotalCOST_1, na.rm = TRUE)`** per day pre-covid19 compared to **`r mean(RawData$TotalCOST_2, na.rm = TRUE)`** per day post-covid19.

For each type of employment sector this is broken down into:  

Permanent staff Pre-covid Mean total cost:  **`r mean(RawData$TotalCOST_Perm_1, na.rm = TRUE)`**
Permanent staff Post-covid Mean total cost:  **`r mean(RawData$TotalCOST_Perm_2, na.rm = TRUE)`**
  
Seasonal staff Pre-covid Mean total cost:  **`r mean(RawData$TotalCOST_Seas_1, na.rm = TRUE)`**
Seasonal staff Post-covid Mean total cost: **`r mean(RawData$TotalCOST_Seas_2, na.rm = TRUE)`**
  
Non-technical staff Pre-covid Mean total cost:  **`r mean(RawData$TotalCOST_NonAq_1, na.rm = TRUE)`**
Non-technical staff Post-covid Mean total cost: **`r mean(RawData$TotalCOST_NonAq_2, na.rm = TRUE)`**

In the following diagram the difference in total staff numbers and the difference in the total cost of labour (cost of labour x number of employees) is plotted as a bubble chart. On this chart the size of the bubble reflects the total labour cost pre-COVID19 and the colour of the bubble the total labour cost post-COVID19.  Therefore a large bubble that is coloured black reflects a farm with a relatively large pre-COVID19 labour cost and a large post-COVID19 labour cost. In contrast a small bubble with a white colour has a low pre- and post-COVID 19 labour cost.  

`r QuadrantTotalLabPlot`  
  
  The plot suggests that farms with larger costs pre-COVID19 reduced their staff numbers more resulting in relatively lower post-COVID19 costs.
  
  Also have created some dumbbell plots to show the change in labour costs pre and post covid. Here as a combined plot  

`r SingleTotalLabDumbbellPlot`  

  And, here as single plots.
  
`r SingleTotalLabDumbbellPlot_Subplot` 
  
```{r Product Prices Basic Stats, include=FALSE}
##############################################
# Include some basic stats about gate prices
##############################################

MeanGate_Pang_1 <- mean(RawData$GatePRICE_Pang_1, na.rm = TRUE)
MeanGate_Pang_2 <- mean(RawData$GatePRICE_Pang_2, na.rm = TRUE)
MeanGate_Tila_1 <- mean(RawData$GatePRICE_Tila_1, na.rm = TRUE)
MeanGate_Tila_2 <- mean(RawData$GatePRICE_Tila_2, na.rm = TRUE)
MeanGate_Carp_1 <- mean(RawData$GatePRICE_Carp_1, na.rm = TRUE)
MeanGate_Carp_2 <- mean(RawData$GatePRICE_Carp_2, na.rm = TRUE)
MeanGate_OtherCat_1 <- mean(RawData$GatePRICE_OtherCat_1, na.rm = TRUE)
MeanGate_OtherCat_2 <- mean(RawData$GatePRICE_OtherCat_2, na.rm = TRUE)



```
## Effect of Covid19 on Product Prices 

### Mean gate prices

Prior to covid19 the mean gate prices for fish were:  
  
 Pangasius: **`r MeanGate_Pang_1`**  
 Tilapia: **`r MeanGate_Tila_1`**  
 Carp: **`r MeanGate_Carp_1`**  
 Other catfish: **`r MeanGate_OtherCat_1`**
 
After covid19 the mean gate prices for fish were:  
  
 Pangasius: **`r MeanGate_Pang_2`**  
 Tilapia: **`r MeanGate_Tila_2`**  
 Carp: **`r MeanGate_Carp_2`**  
 Other catfish: **`r MeanGate_OtherCat_2`**
 
The percentage decrease in prices were:  
  Pangasius: **`r (MeanGate_Pang_2 - MeanGate_Pang_1) / MeanGate_Pang_2 * 100`**  
  Tilapia: **`r (MeanGate_Tila_2 - MeanGate_Tila_1) / MeanGate_Tila_2 * 100`**  
  Carp: **`r (MeanGate_Carp_2 - MeanGate_Carp_1) / MeanGate_Carp_2 * 100`**  
  Other catfish: **`r (MeanGate_OtherCat_2 - MeanGate_OtherCat_1) / MeanGate_OtherCat_2 * 100`** 
  
 